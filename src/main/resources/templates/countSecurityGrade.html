<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Оценка защищенности</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
</head>
<body>
<form th:method="POST" th:object="${stages}" action="securityGrade" th:align="center" style="
    padding: 12px 20px;
    margin: 8px 0;
    max-width: 80%;
">
    <header>
        <h1 th:align="center" th:inline="text" >
            Профиль безопасности требуемый
            [[${requiredSecurityProfile}]]
        </h1>
    </header>
    <table class="table table-striped-columns">
        <thead>
        <tr>
            <th scope="col">№ элемента матрицы</th>
            <th scope="col">Коэффициент важности</th>
            <th scope="col">Профиль безопасности достигнутый</th>
            <th scope="col">Qд*aj</th>
            <th scope="col">Сравнение профилей</th>
            <th scope="col">Степень выполнения групп требований</th>
        </tr>
        </thead>
        <tbody>
        <div th:remove="tag" th:each="stageDTO, itemStat : ${stages.stageDTOS}">
            <tr>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].base.matrixElementNumber|" th:value="${stageDTO.getBase().getMatrixElementNumber()}"/>
                    <span th:text="${stageDTO.base.matrixElementNumber}"/>
                </td>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].base.importanceFactor|" th:value="${stageDTO.getBase().getImportanceFactor()}"/>
                    <span th:text="${stageDTO.base.importanceFactor}"/>
                </td>
                <td>
                    <input th:name="|stageDTOS[${itemStat.index}].base.achievedSecurityProfile|" th:value="${stageDTO.getBase().getAchievedSecurityProfile()}"/>
                </td>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].base.importanceFactorMultiplyByAchievedSecurityProfile|" th:value="${stageDTO.getBase().getImportanceFactorMultiplyByAchievedSecurityProfile()}"/>
                    <span th:text="${stageDTO.base.importanceFactorMultiplyByAchievedSecurityProfile}"/>
                </td>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].base.profileComparison|" th:value="${stageDTO.getBase().getProfileComparison()}"/>
                    <span th:text="${stageDTO.base.profileComparison}"/>
                </td>
                <td th:rowspan="4">
                    <input hidden th:name="|stageDTOS[${itemStat.index}].requirementGroupsFulfillment|" th:value="${stageDTO.getRequirementGroupsFulfillment()}"/>
                    <span th:text="${stageDTO.requirementGroupsFulfillment}"/>
                </td>
            </tr>
            <tr>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].structure.matrixElementNumber|" th:value="${stageDTO.getStructure().getMatrixElementNumber()}"/>
                    <span th:text="${stageDTO.structure.matrixElementNumber}"/>
                </td>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].structure.importanceFactor|" th:value="${stageDTO.getStructure().getImportanceFactor()}"/>
                    <span th:text="${stageDTO.structure.importanceFactor}"/>
                </td>
                <td>
                    <input th:name="|stageDTOS[${itemStat.index}].structure.achievedSecurityProfile|" th:value="${stageDTO.getStructure().getAchievedSecurityProfile()}"/>
                </td>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].structure.importanceFactorMultiplyByAchievedSecurityProfile|" th:value="${stageDTO.getStructure().getImportanceFactorMultiplyByAchievedSecurityProfile()}"/>
                    <span th:text="${stageDTO.structure.importanceFactorMultiplyByAchievedSecurityProfile}"/>
                </td>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].structure.profileComparison|" th:value="${stageDTO.getStructure().getProfileComparison()}"/>
                    <span th:text="${stageDTO.structure.profileComparison}"/>
                </td>
            </tr>
            <tr>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].measures.matrixElementNumber|" th:value="${stageDTO.getMeasures().getMatrixElementNumber()}"/>
                    <span th:text="${stageDTO.measures.matrixElementNumber}"/>
                </td>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].measures.importanceFactor|" th:value="${stageDTO.getMeasures().getImportanceFactor()}"/>
                    <span th:text="${stageDTO.measures.importanceFactor}"/>
                </td>
                <td>
                    <input th:name="|stageDTOS[${itemStat.index}].measures.achievedSecurityProfile|" th:value="${stageDTO.getMeasures().getAchievedSecurityProfile()}"/>
                </td>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].measures.importanceFactorMultiplyByAchievedSecurityProfile|" th:value="${stageDTO.getMeasures().getImportanceFactorMultiplyByAchievedSecurityProfile()}"/>
                    <span th:text="${stageDTO.measures.importanceFactorMultiplyByAchievedSecurityProfile}"/>
                </td>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].measures.profileComparison|" th:value="${stageDTO.getMeasures().getProfileComparison()}"/>
                    <span th:text="${stageDTO.measures.profileComparison}"/>
                </td>
            </tr>
            <tr>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].resources.matrixElementNumber|" th:value="${stageDTO.getResources().getMatrixElementNumber()}"/>
                    <span th:text="${stageDTO.resources.matrixElementNumber}"/>
                </td>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].resources.importanceFactor|" th:value="${stageDTO.getResources().getImportanceFactor()}"/>
                    <span th:text="${stageDTO.resources.importanceFactor}"/>
                </td>
                <td>
                    <input th:name="|stageDTOS[${itemStat.index}].resources.achievedSecurityProfile|" th:value="${stageDTO.getResources().getAchievedSecurityProfile()}"/>
                </td>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].resources.importanceFactorMultiplyByAchievedSecurityProfile|" th:value="${stageDTO.getResources().getImportanceFactorMultiplyByAchievedSecurityProfile()}"/>
                    <span th:text="${stageDTO.resources.importanceFactorMultiplyByAchievedSecurityProfile}"/>
                </td>
                <td>
                    <input hidden th:name="|stageDTOS[${itemStat.index}].resources.profileComparison|" th:value="${stageDTO.getResources().getProfileComparison()}"/>
                    <span th:text="${stageDTO.resources.profileComparison}"/>
                </td>
            </tr>
        </div>
        </tbody>
    </table>
    <h1 th:align="center" th:inline="text" style="
    display: flex;
    flex-direction: row;
    justify-content: space-between;
">
        <div th:align="left" th:inline="text" style="display:block">
            Качественная оценка
            [[${qualityGrade}]]
        </div>
        <div th:align="right" th:inline="text" style="display:block">
            Количественная оценка
            [[${quantityGrade}]]
        </div>
    </h1>

    <table class="table table-striped-columns">
        <thead>
        <tr>
            <td th:rowspan="2">Показатели</td>
            <td th:colspan="7">Направления защиты</td>
            <td th:rowspan="2">Qсзи</td>
        </tr>
        <tr>
            <td th:each="stageDTOS, itemStat : ${stages.stageDTOS}">
                <span th:text="${itemStat.index+1}"></span>
            </td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Качественный</td>
            <td th:each="stageDTO : ${stages.stageDTOS}" th:text="${stageDTO.requirementGroupsFulfillment}"></td>
            <td>[[${qualityGrade}]]</td>
        </tr>
        <tr>
            <td>Количественный</td>
            <td th:each="stageDTO : ${stages.stageDTOS}" th:text="${
                (stageDTO.base.profileComparison +
                stageDTO.structure.profileComparison +
                stageDTO.measures.profileComparison +
                stageDTO.resources.profileComparison) / 4.0
            }"></td>
            <td>[[${quantityGrade}]]</td>
        </tr>
        </tbody>
    </table>

    <div>
        <input hidden th:name="requiredSecurityProfile" th:value="${requiredSecurityProfile}"/>
        <input type="submit" value="Рассчитать оценку" style="margin: .4rem"/>
    </div>
</form>
</body>
</html>